import zipfile
import os
from collections import defaultdict
import random

# 경로 설정
input_zip = "kfood.zip"
output_zip = "reduced_kfood.zip"
max_images_per_class = 12

# 음식별로 파일을 저장할 딕셔너리
food_dict = defaultdict(list)

# 기존 zip파일 열기
with zipfile.ZipFile(input_zip, 'r') as zin:
    # 모든 파일 경로 가져오기
    for file in zin.namelist():
        if file.endswith(('.jpg', '.jpeg', '.png')) and '/' in file:
            folder = file.split('/')[0]
            food_dict[folder].append(file)

    # 새로운 zip파일 생성
    with zipfile.ZipFile(output_zip, 'w') as zout:
        for food, files in food_dict.items():
            # 이미지 수 줄이기 (랜덤 또는 앞 12장)
            selected = random.sample(files, min(len(files), max_images_per_class))
            for file in selected:
                zout.writestr(file, zin.read(file))

print(f"{output_zip} 생성 완료!")
